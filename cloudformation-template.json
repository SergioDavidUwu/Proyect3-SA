{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Resources": {
      "PublicSubnet": {
        "Type": "AWS::EC2::Subnet",
        "Properties": {
          "VpcId": {
            "Ref": "VPC"
          },
          "CidrBlock": "10.0.0.0/24"
        },
        "Metadata": {
          "AWS::CloudFormation::Designer": {
            "id": "47ccc475-1530-45ee-8828-ca13b95aff5b"
          }
        }
      },
      "VPC": {
        "Type": "AWS::EC2::VPC",
        "Properties": {
          "EnableDnsSupport": "true",
          "EnableDnsHostnames": "true",
          "CidrBlock": "10.0.0.0/16"
        }
      },
      //codigo cheko
      "VPC": {
        "Type": "AWS::EC2::VPC",
        "Properties": {
          "EnableDnsSupport": "true",
          "EnableDnsHostnames": "true",
          "CidrBlock": "10.0.0.0/16"
        }
      },
      "webServer": {
        "Type": "AWS::EC2::Instance",
        "Properties": {
          "InstanceType": {
            "Ref": "InstanceType"
          },
          "ImageId": {
            "Fn::FindInMap": [
              "AWSRegionArch2AMI",
              {
                "Ref": "AWS::Region"
              },
              {
                "Fn::FindInMap": [
                  "AWSInstanceType2Arch",
                  {
                    "Ref": "InstanceType"
                  },
                  "Arch"
                ]
              }
            ]
          },
          "KeyName": {
            "Ref": "KeyName"
          },
          "NetworkInterfaces": [
            {
              "GroupSet": [
                {
                  "Ref": "WebServerSG"
                }
              ],
              "AssociatePublicIpAddress": "true",
              "DeviceIndex": "0",
              "DeleteOnTermination": "true",
              "SubnetId": {
                "Ref": "PublicSubnet"
              }
            }
          ],
          "UserData": {
            "Fn::Base64": {
              "Fn::Join": [
                "",
                [
                  "#!/bin/bash -xe\n",
                  "yum install -y aws-cfn-bootstrap\n",
                  "# Install the files and packages from the metadata\n",
                  "/opt/aws/bin/cfn-init -v ",
                  "         --stack ",
                  {
                    "Ref": "AWS::StackName"
                  },
                  "         --resource webServer ",
                  "         --configsets All ",
                  "         --region ",
                  {
                    "Ref": "AWS::Region"
                  },
                  "\n",
                  "# Signal the status from cfn-init\n",
                  "/opt/aws/bin/cfn-signal -e $? ",
                  "         --stack ",
                  {
                    "Ref": "AWS::StackName"
                  },
                  "         --resource webServer ",
                  "         --region ",
                  {
                    "Ref": "AWS::Region"
                  },
                  "\n"
                ]
              ]
            }
          }
        },
        "Metadata": {
          "AWS::CloudFormation::Designer": {
            "id": "5f6d66c6-36e9-4bd5-af72-ca4dcf4a96b2"
          },
          "AWS::CloudFormation::Init": {
            "configSets": {
              "All": ["ConfigureSampleApp"]
            },
            "ConfigureSampleApp": {
              "packages": {
                "yum": {
                  "httpd": []
                }
              },
              "files": {
                "/var/www/html/index.html": {
                  "content": {
                    "Fn::Join": [
                      "\n",
                      [
                        "<h1>Congratulations, you have successfully launched the AWS CloudFormation sample.</h1>"
                      ]
                    ]
                  },
                  "mode": "000644",
                  "owner": "root",
                  "group": "root"
                }
              },
              "services": {
                "sysvinit": {
                  "httpd": {
                    "enabled": "true",
                    "ensureRunning": "true"
                  }
                }
              }
            }
          }
        }
      },
      //Codigo_Alan
      "WebServerSG": {
        "Type": "AWS::EC2::SecurityGroup",
        "Properties": {
          "VpcId": {
            "Ref": "VPC"
          },
          "GroupDescription": "Allow access from HTTP and SSH traffic",
          "SecurityGroupIngress": [
            {
              "IpProtocol": "tcp",
              "FromPort": "80",
              "ToPort": "80",
              "CidrIp": "0.0.0.0/0"
            },
            {
              "IpProtocol": "tcp",
              "FromPort": "22",
              "ToPort": "22",
              "CidrIp": {
                "Ref": "SSHLocation"
              }
            }
          ]
        },
        "Metadata": {
          "AWS::CloudFormation::Designer": {
            "id": "78191ea4-d03b-4545-8661-f086ad75ec7f"
          }
        }
      },
      "InternetGateway": {
        "Type": "AWS::EC2::InternetGateway",
        "Properties": {},
        "Metadata": {
          "AWS::CloudFormation::Designer": {
            "id": "447e6525-2e58-4e13-8a1e-c208eded04eb"
          }
        }
      },
      "EC2VPCG1LRG1": {
        "Type": "AWS::EC2::VPCGatewayAttachment",
        "Properties": {
          "VpcId": {
            "Ref": "VPC"
          },
          "InternetGatewayId": {
            "Ref": "InternetGateway"
          }
        },
        "Metadata": {
          "AWS::CloudFormation::Designer": {
            "id": "b568c607-10fe-485b-80ca-dfbeca54710a"
          }
        }
      },
      "PublicRouteTable": {
        "Type": "AWS::EC2::RouteTable",
        "Properties": {
          "VpcId": {
            "Ref": "VPC"
          }
        },
        "Metadata": {
          "AWS::CloudFormation::Designer": {
            "id": "a9cc8c0b-41a9-4e9a-be62-c9c5dd0d9263"
          }
        }
      },
      "PublicRoute": {
        "Type": "AWS::EC2::Route",
        "Properties": {
          "DestinationCidrBlock": "0.0.0.0/0",
          "RouteTableId": {
            "Ref": "PublicRouteTable"
          },
          "InstanceId": {
            "Ref": "webServer"
          },
          "GatewayId": {
            "Ref": "InternetGateway"
          }
        },
        "Metadata": {
          "AWS::CloudFormation::Designer": {
            "id": "a03af88a-ab50-40c7-a4cd-0a5bc85e4b07"
          }
        },
        "DependsOn": ["EC2VPCG1LRG1"]
      },
      "EC2SRTA2CTSW": {
        "Type": "AWS::EC2::SubnetRouteTableAssociation",
        "Properties": {
          "RouteTableId": {
            "Ref": "PublicRouteTable"
          },
          "SubnetId": {
            "Ref": "PublicSubnet"
          }
        },
        "Metadata": {
          "AWS::CloudFormation::Designer": {
            "id": "bcd8ab0a-0735-4d0e-b604-cb91eaf161e9"
          }
        }
      },
      "AutoScaling": {
        "Type": "AWS::AutoScaling::AutoScalingGroup",
        "Properties": {
          "InstanceId": {
            "Ref": "webServer"
          }
        },
        "Metadata": {
          "AWS::CloudFormation::Designer": {
            "id": "66297ad4-1f7e-4b40-804a-6c1dd6559c56"
          }
        }
      },
      "RDSDB": {
        "Type": "AWS::RDS::DBInstance",
        "Properties": {},
        "Metadata": {
          "AWS::CloudFormation::Designer": {
            "id": "2275e413-fc93-47e1-8411-4c848987a339"
          }
        },
        "DependsOn": ["PublicSubnet", "webServer", "EDSSG"]
      },
      "PrivateSubnet": {
        "Type": "AWS::EC2::Subnet",
        "Properties": {
          "VpcId": {
            "Ref": "VPC"
          }
        },
        "Metadata": {
          "AWS::CloudFormation::Designer": {
            "id": "6fd19639-4d5d-40db-85c7-353555ac78b4"
          }
        }
      },
      "EDSSG": {
        "Type": "AWS::EC2::SecurityGroup",
        "Properties": {
          "VpcId": {
            "Ref": "VPC"
          },
          "GroupDescription": "Allow access from HTTP and SSH traffic",
          "SecurityGroupIngress": [
            {
              "IpProtocol": "tcp",
              "FromPort": "3306",
              "ToPort": "3306",
              "CidrIp": "0.0.0.0/0"
            },
            {
              "IpProtocol": "tcp",
              "FromPort": "22",
              "ToPort": "22",
              "CidrIp": {
                "Ref": "SSHLocation"
              }
            }
          ]
        },
        "Metadata": {
          "AWS::CloudFormation::Designer": {
            "id": "d5f098e0-5f1a-44a7-8d17-eb478d96f93e"
          }
        }
      },
      //continuacion cheko